<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>PDD çˆ†æ¬¾æ ‡é¢˜é»‘å®¢ | å¾è¯¾é•¿å®æˆ˜ç³»ç»Ÿ</title>
    <style>
        :root {
            --bg-core: #0f172a;        /* æ·±ç©ºè“ */
            --bg-card: #1e293b;        /* å¡ç‰‡åº• */
            --bg-input: #0b1120;       /* è¾“å…¥æ¡† */
            --text-main: #f8fafc;
            --text-sub: #94a3b8;
            --accent-pdd: #e02e24;     /* PDDçº¢ */
            --accent-gold: #fbbf24;    /* é»‘é‡‘ */
            --accent-safe: #10b981;    /* å®‰å…¨ç»¿ */
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, "PingFang SC", "Microsoft YaHei", sans-serif;
            background-color: var(--bg-core);
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-bottom: 3rem;
            position: relative;
            overflow-x: hidden;
            
            /* --- æ ¸å¿ƒæ°´å°æ ·å¼ --- */
            /* ä½¿ç”¨ SVG data URI ç”Ÿæˆé‡å¤çš„æ–œçº¹æ°´å° */
            background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg width='300' height='300' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext x='50%25' y='50%25' font-family='sans-serif' font-size='14' fill='rgba(255,255,255,0.03)' transform='rotate(-45 150 150)' text-anchor='middle' dominant-baseline='middle'%3Eå…¬ä¼—å·ï¼šå¾è¯¾é•¿ ç”µå¾®ï¼š13683520302%3C/text%3E%3C/svg%3E");
        }

        /* å¤´éƒ¨ */
        header {
            padding: 2.5rem 1.5rem 1.5rem;
            text-align: center;
            width: 100%;
            max-width: 800px;
            z-index: 10;
        }

        h1 {
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #fff 30%, var(--accent-pdd) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .subtitle { font-size: 0.8rem; color: var(--text-sub); margin-bottom: 12px; }

        .tags-line {
            display: flex;
            justify-content: center;
            gap: 8px;
            font-size: 0.7rem;
        }
        .tag-pill {
            background: rgba(255,255,255,0.05);
            padding: 3px 8px;
            border-radius: 4px;
            color: var(--accent-gold);
            border: 1px solid rgba(251, 191, 36, 0.2);
            backdrop-filter: blur(4px);
        }

        /* è®¾ç½®é¢æ¿ */
        .settings-panel {
            width: 92%;
            max-width: 600px;
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            border: 1px dashed rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            margin-bottom: 1.5rem;
            overflow: hidden;
            z-index: 10;
        }

        .settings-header {
            padding: 12px 15px;
            font-size: 0.8rem;
            color: var(--text-sub);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0,0,0,0.2);
        }

        .settings-content { padding: 15px; display: none; }
        .settings-content.active { display: block; }
        
        .settings-input {
            width: 100%;
            background: var(--bg-input);
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--text-main);
            padding: 10px;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-bottom: 10px;
        }

        /* ä¸»è¾“å…¥åŒº */
        main {
            width: 100%;
            max-width: 600px;
            padding: 0 1rem;
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
            z-index: 10;
        }

        .input-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid rgba(255,255,255,0.08);
            box-shadow: 0 10px 30px -5px rgba(0,0,0,0.4);
            backdrop-filter: blur(5px);
        }

        .strategy-box { display: flex; gap: 8px; margin-bottom: 1rem; }
        .strategy-btn {
            flex: 1;
            text-align: center;
            padding: 10px 5px;
            font-size: 0.8rem;
            background: rgba(255,255,255,0.03);
            border: 1px solid transparent;
            border-radius: 8px;
            color: var(--text-sub);
            cursor: pointer;
            transition: 0.2s;
        }
        .strategy-btn.active {
            background: rgba(224, 46, 36, 0.1);
            border-color: var(--accent-pdd);
            color: var(--accent-pdd);
            font-weight: 700;
        }

        .main-textarea {
            width: 100%;
            height: 110px;
            background: var(--bg-input);
            border: 1px solid #334155;
            border-radius: 10px;
            padding: 1rem;
            color: var(--text-main);
            font-size: 1rem;
            resize: none;
            outline: none;
            margin-bottom: 1rem;
        }
        .main-textarea:focus { border-color: var(--accent-pdd); }

        .generate-btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 50px;
            background: linear-gradient(90deg, #ff5c00, var(--accent-pdd));
            color: white;
            font-size: 1.1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(224, 46, 36, 0.3);
        }
        .generate-btn:active { transform: scale(0.98); }

        /* ç»“æœå±•ç¤º */
        #result-area { margin-top: 0.5rem; display: flex; flex-direction: column; gap: 1rem; }

        .result-card {
            background: rgba(30, 41, 59, 0.8); /* ç¨å¾®ä¸é€æ˜ä¸€ç‚¹ï¼Œé®æŒ¡æ°´å°ï¼Œåˆ©äºé˜…è¯» */
            border: 1px solid rgba(255,255,255,0.05);
            padding: 1rem;
            border-radius: 10px;
            position: relative;
            animation: slideUp 0.4s ease-out;
            backdrop-filter: blur(5px);
        }

        .result-title {
            font-size: 1rem;
            line-height: 1.5;
            color: #e2e8f0;
            padding-right: 3rem;
            margin-bottom: 10px;
        }

        .highlight-keyword { color: var(--accent-gold); font-weight: bold; }
        
        /* ä¿®æ­£åçš„è¯æ ·å¼ */
        .fixed-word {
            color: var(--accent-safe);
            border-bottom: 1px dashed var(--accent-safe);
            font-weight: bold;
            cursor: help;
        }

        .result-tags { display: flex; gap: 6px; font-size: 0.7rem; align-items: center; }
        .tag-safe { color: var(--accent-safe); background: rgba(16,185,129,0.1); padding: 2px 6px; border-radius: 4px; border: 1px solid rgba(16,185,129,0.2); }
        .tag-auto { color: var(--accent-blue); background: rgba(56,189,248,0.1); padding: 2px 6px; border-radius: 4px; }

        .copy-btn {
            position: absolute;
            right: 10px;
            top: 15px;
            background: transparent;
            border: 1px solid rgba(255,255,255,0.2);
            color: var(--text-sub);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            cursor: pointer;
        }

        /* åº•éƒ¨é¡µè„š */
        footer {
            margin-top: auto;
            padding: 2rem 1rem;
            text-align: center;
            color: var(--text-sub);
            font-size: 0.75rem;
            opacity: 0.6;
            z-index: 10;
        }

        /* åŠ¨ç”» */
        .spinner {
            width: 18px; height: 18px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            display: none;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    </style>
</head>
<body>

    <header>
        <h1>PDD æ ‡é¢˜é»‘å®¢ <span style="font-size:0.5em; vertical-align:top; color:var(--accent-gold);">2026</span></h1>
        <p class="subtitle">æ™ºèƒ½æ¸…æ´—è¿ç¦è¯ Â· ç”Ÿæˆå³åˆè§„</p>
        <div class="tags-line">
            <span class="tag-pill">å…¨è‡ªåŠ¨å»é£é™©</span>
            <span class="tag-pill">2026ç®—æ³•æƒé‡</span>
            <span class="tag-pill">ç‚¹å‡»ç‡å€å¢</span>
        </div>
    </header>

    <!-- è®¾ç½®é¢æ¿ -->
    <div class="settings-panel">
        <div class="settings-header" onclick="toggleSettings()">
            <span>âš™ï¸ ç³»ç»Ÿè®¾ç½® (API Key)</span>
            <span>â–¼</span>
        </div>
        <div class="settings-content" id="settings-content">
            <input type="password" id="apiKey" class="settings-input" placeholder="è¯·è¾“å…¥ API Key (è‡ªåŠ¨ä¿å­˜)" onchange="saveConfig()">
            <input type="text" id="apiEndpoint" class="settings-input" value="https://ark.cn-beijing.volces.com/api/v3/chat/completions" onchange="saveConfig()">
            <input type="text" id="modelName" class="settings-input" value="doubao-seed-1-6-251015" onchange="saveConfig()">
        </div>
    </div>

    <main>
        <div class="input-card">
            <div class="strategy-box">
                <div class="strategy-btn active" onclick="setStrategy(this, 'price')">ğŸ”¥ ä½ä»·è·‘é‡</div>
                <div class="strategy-btn" onclick="setStrategy(this, 'quality')">ğŸ’ å“è´¨é«˜å®¢å•</div>
                <div class="strategy-btn" onclick="setStrategy(this, 'niche')">ğŸ¯ åœºæ™¯/é€ç¤¼</div>
            </div>

            <textarea id="userInput" class="main-textarea" placeholder="è¯·è¾“å…¥äº§å“å…³é”®è¯ï¼ˆå¦‚ï¼šè™šæ‹Ÿå¼€åº—æ•™ç¨‹ã€PSè½¯ä»¶ã€å‰¯ä¸šé¡¹ç›®ï¼‰..."></textarea>
            
            <button class="generate-btn" onclick="generateTitles()">
                <div class="spinner" id="spinner"></div>
                <span id="btnText">ä¸€é”®ç”Ÿæˆåˆè§„çˆ†æ¬¾</span>
            </button>
        </div>

        <div id="result-area"></div>
    </main>

    <footer>
        <p>å¾è¯¾é•¿AIæ•°å­—èµ„äº§æ„å»ºå•†ä¸šå˜ç°å®æˆ˜ç³»ç»Ÿ</p>
        <p style="margin-top:5px; font-size:0.7rem;">Copyright Â© 2026 All Rights Reserved</p>
    </footer>

    <script>
        let currentStrategy = 'price';
        
        // --- æ ¸å¿ƒï¼šè¿ç¦è¯æ›¿æ¢è¯å…¸ (Smart Replacement Map) ---
        // é”®ï¼šè¿ç¦è¯ï¼Œå€¼ï¼šåˆè§„é«˜ç‚¹å‡»æ›¿ä»£è¯
        const replacementMap = {
            'ç¬¬ä¸€': 'è¡Œä¸šå¤©èŠ±æ¿',
            'æœ€å¼º': 'ç‹ è´§',
            'æœ€å¥½': 'å®è—',
            'æœ€ä½³': 'å¿…é€‰',
            'é¡¶çº§': 'é«˜é…',
            'æè‡´': 'å‘çƒ§çº§',
            'å®Œç¾': 'ç»™åŠ›',
            'é¦–é€‰': 'å¿…å…¥',
            'ç‹¬å®¶': 'ç¨€ç¼º',
            'å”¯ä¸€': 'å°‘è§',
            'åŒ…èµš': 'æç±³',
            'èººèµš': 'å‰¯ä¸š',
            'æš´å¯Œ': 'èµ·é£',
            'æœˆå…¥': 'å˜ç°',
            '100%': 'è¶…ç¨³',
            'ç™¾åˆ†ç™¾': 'è¶…ç¨³',
            'åŒ…è¿‡': 'åŠ©è€ƒ',
            'åŒ…ä¼š': 'æ˜“ä¸Šæ‰‹',
            'ç¥å™¨': 'å¿…å¤‡', // éƒ¨åˆ†ç±»ç›®ç¥å™¨è¿è§„ï¼Œæ›¿æ¢ä¸ºå¿…å¤‡
            'å¥‡æ•ˆ': 'ç»™åŠ›'
        };

        window.onload = function() {
            if(localStorage.getItem('xk_apiKey')) document.getElementById('apiKey').value = localStorage.getItem('xk_apiKey');
            if(localStorage.getItem('xk_endpoint')) document.getElementById('apiEndpoint').value = localStorage.getItem('xk_endpoint');
            if(localStorage.getItem('xk_model')) document.getElementById('modelName').value = localStorage.getItem('xk_model');
        }

        function toggleSettings() { document.getElementById('settings-content').classList.toggle('active'); }
        function saveConfig() {
            localStorage.setItem('xk_apiKey', document.getElementById('apiKey').value);
            localStorage.setItem('xk_endpoint', document.getElementById('apiEndpoint').value);
            localStorage.setItem('xk_model', document.getElementById('modelName').value);
        }
        function setStrategy(el, type) {
            document.querySelectorAll('.strategy-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
            currentStrategy = type;
        }

        // --- æ™ºèƒ½æ¸…æ´—å‡½æ•° ---
        function cleanAndReplace(text) {
            let replacedText = text;
            let fixedCount = 0;
            
            // éå†è¯å…¸è¿›è¡Œæ›¿æ¢
            for (const [riskWord, safeWord] of Object.entries(replacementMap)) {
                if (replacedText.includes(riskWord)) {
                    // å…¨å±€æ›¿æ¢ï¼Œå¹¶æ ‡è®°æ ·å¼ï¼ˆæš‚ä¸åŠ æ ·å¼ï¼Œç›´æ¥æ”¹æ–‡å­—ï¼Œä¿è¯å¤åˆ¶å‡ºæ¥æ˜¯å¹²å‡€çš„ï¼‰
                    const regex = new RegExp(riskWord, 'g');
                    replacedText = replacedText.replace(regex, safeWord);
                    fixedCount++;
                }
            }
            return { text: replacedText, count: fixedCount };
        }

        async function generateTitles() {
            const input = document.getElementById('userInput').value;
            const apiKey = document.getElementById('apiKey').value;
            const endpoint = document.getElementById('apiEndpoint').value;
            const model = document.getElementById('modelName').value;

            saveConfig();
            if (!input) return alert('è¯·å…ˆè¾“å…¥å…³é”®è¯ï¼');
            if (!apiKey) { toggleSettings(); return alert('è¯·å…ˆé…ç½® API Keyï¼'); }

            const btn = document.querySelector('.generate-btn');
            const spinner = document.getElementById('spinner');
            const btnText = document.getElementById('btnText');
            const resultArea = document.getElementById('result-area');

            btn.disabled = true;
            spinner.style.display = 'block';
            btnText.innerText = 'AIæ­£åœ¨æ¸…æ´—è¿ç¦è¯...';
            resultArea.innerHTML = '';

            // Prompt ä¾ç„¶è¦æ±‚ AI å°½é‡è§„é¿ï¼ŒåŒé‡ä¿é™©
            let strategyContext = currentStrategy === 'price' 
                ? "ç­–ç•¥ï¼šä½ä»·è·‘é‡ã€‚ç”¨è¯ï¼šã€2026æ¸…ä»“ã€‘ã€å°ç™½ã€æ¸…ä»“ã€æ‰‹æœºå¯åšã€‚" 
                : "ç­–ç•¥ï¼šå“è´¨/æœåŠ¡ã€‚ç”¨è¯ï¼šã€2026å‡çº§ç‰ˆã€‘ã€çº¯äººå·¥ã€ä¸€å¯¹ä¸€ã€ç»ˆèº«ç‰ˆã€‚";

            const systemPrompt = `ä½ æ˜¯ä¸€åç²¾é€š2026æ‹¼å¤šå¤šæ–°è§„çš„ç”µå•†ä¸“å®¶ã€‚ç”Ÿæˆ5ä¸ªæ— è¿è§„çš„çˆ†æ¬¾æ ‡é¢˜ã€‚
            ${strategyContext}
            è¦æ±‚ï¼šåŒ…å«ã€2026ã€‘æˆ–ã€æœ€æ–°ã€‘ã€‚ç»å¯¹ä¸è¦ä½¿ç”¨â€œç¬¬ä¸€ã€åŒ…èµšã€100%â€ç­‰è¿ç¦è¯ã€‚
            æ ¼å¼ï¼š5è¡Œçº¯æ–‡æœ¬ã€‚`;

            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + apiKey },
                    body: JSON.stringify({
                        model: model,
                        messages: [{ role: "system", content: systemPrompt }, { role: "user", content: input }],
                        temperature: 0.8
                    })
                });

                if (!response.ok) throw new Error(`è¯·æ±‚å¤±è´¥ (${response.status})`);
                const data = await response.json();
                let content = data.choices ? data.choices[0].message.content : JSON.stringify(data);
                
                const titles = content.split('\n').filter(t => t.trim().length > 5);

                titles.forEach(title => {
                    let cleanTitle = title.replace(/^\d+\.\s*/, '').replace(/\*\*/g, '').trim();
                    
                    // --- 1. æ‰§è¡Œæ™ºèƒ½æ›¿æ¢ ---
                    const { text: safeTitle, count } = cleanAndReplace(cleanTitle);

                    // --- 2. è§†è§‰å¤„ç† ---
                    // é«˜äº® ã€ã€‘ é‡Œçš„å†…å®¹
                    let displayTitle = safeTitle.replace(/ã€.*?ã€‘/g, match => `<span class="highlight-keyword">${match}</span>`);

                    // --- 3. ç”Ÿæˆå¡ç‰‡ ---
                    const card = document.createElement('div');
                    card.className = 'result-card';
                    
                    // çŠ¶æ€æ ‡ç­¾
                    let statusTag = `<span class="tag-safe">âœ… 100%åˆè§„</span>`;
                    if (count > 0) {
                        statusTag += ` <span style="font-size:0.7rem; color:var(--text-sub); margin-left:5px;">(å·²è‡ªåŠ¨ä¿®æ­£ ${count} å¤„è¿è§„)</span>`;
                    }

                    card.innerHTML = `
                        <div class="result-title">${displayTitle}</div>
                        <div class="result-tags">
                            ${statusTag}
                        </div>
                        <button class="copy-btn" onclick="copyText(this, '${safeTitle}')">å¤åˆ¶</button>
                    `;
                    resultArea.appendChild(card);
                });

            } catch (error) {
                alert('ç”Ÿæˆå‡ºé”™ï¼š' + error.message);
            } finally {
                btn.disabled = false;
                spinner.style.display = 'none';
                btnText.innerText = 'ä¸€é”®ç”Ÿæˆåˆè§„çˆ†æ¬¾';
            }
        }

        function copyText(btn, text) {
            navigator.clipboard.writeText(text).then(() => {
                let old = btn.innerText;
                btn.innerText = 'å·²å¤åˆ¶';
                btn.style.color = '#10b981';
                btn.style.borderColor = '#10b981';
                setTimeout(() => { 
                    btn.innerText = old; 
                    btn.style.color = 'var(--text-sub)'; 
                    btn.style.borderColor = 'rgba(255,255,255,0.2)';
                }, 1500);
            });
        }
    </script>
</body>
</html>
